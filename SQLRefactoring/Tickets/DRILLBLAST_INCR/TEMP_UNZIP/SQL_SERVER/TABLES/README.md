# SQL Server INCR Tables

This folder contains the DDL scripts for creating INCR (incremental) tables in SQL Server database `SNOWFLAKE_WG`.

## Tables Overview

| Table Name | Source (Snowflake) | Primary Key | Archival Column |
|------------|-------------------|-------------|-----------------|
| **DRILL_BLAST Tables** ||||
| `DRILL_BLAST__BLAST_PLAN_INCR` | DEV_API_REF.FUSE.BLAST_PLAN_INCR | BLAST_PLAN_SK | DW_MODIFY_TS |
| `DRILL_BLAST__BLAST_PLAN_EXECUTION_INCR` | DEV_API_REF.FUSE.BLAST_PLAN_EXECUTION_INCR | Composite | DW_MODIFY_TS |
| `DRILL_BLAST__BL_DW_BLAST_INCR` | DEV_API_REF.FUSE.BL_DW_BLAST_INCR | ORIG_SRC_ID, SITE_CODE, ID | DW_MODIFY_TS |
| `DRILL_BLAST__BL_DW_BLASTPROPERTYVALUE_INCR` | DEV_API_REF.FUSE.BL_DW_BLASTPROPERTYVALUE_INCR | ORIG_SRC_ID, SITE_CODE, BLASTID | DW_MODIFY_TS |
| `DRILL_BLAST__BL_DW_HOLE_INCR` | DEV_API_REF.FUSE.BL_DW_HOLE_INCR | ORIG_SRC_ID, SITE_CODE, ID | DW_MODIFY_TS |
| `DRILL_BLAST__DRILLBLAST_EQUIPMENT_INCR` | DEV_API_REF.FUSE.DRILLBLAST_EQUIPMENT_INCR | ORIG_SRC_ID, SITE_CODE, DRILL_ID | DW_MODIFY_TS |
| `DRILL_BLAST__DRILLBLAST_OPERATOR_INCR` | DEV_API_REF.FUSE.DRILLBLAST_OPERATOR_INCR | SYSTEM_OPERATOR_ID, SITE_CODE | DW_MODIFY_TS |
| `DRILL_BLAST__DRILLBLAST_SHIFT_INCR` | DEV_API_REF.FUSE.DRILLBLAST_SHIFT_INCR | SITE_CODE, SHIFT_ID | DW_MODIFY_TS |
| `DRILL_BLAST__DRILL_CYCLE_INCR` | DEV_API_REF.FUSE.DRILL_CYCLE_INCR | DRILL_CYCLE_SK | DW_MODIFY_TS |
| `DRILL_BLAST__DRILL_PLAN_INCR` | DEV_API_REF.FUSE.DRILL_PLAN_INCR | DRILL_PLAN_SK | DW_MODIFY_TS |
| **LOAD_HAUL Tables** ||||
| `LOAD_HAUL__LH_HAUL_CYCLE_INCR` | DEV_API_REF.FUSE.LH_HAUL_CYCLE_INCR | HAUL_CYCLE_ID | DW_MODIFY_TS |
| `LOAD_HAUL__LH_EQUIPMENT_STATUS_EVENT_INCR` | DEV_API_REF.FUSE.LH_EQUIPMENT_STATUS_EVENT_INCR | Composite | **START_TS_LOCAL** |
| `LOAD_HAUL__LH_LOADING_CYCLE_INCR` | DEV_API_REF.FUSE.LH_LOADING_CYCLE_INCR | LOADING_CYCLE_ID | **CYCLE_START_TS_LOCAL** |
| `LOAD_HAUL__LH_BUCKET_INCR` | DEV_API_REF.FUSE.LH_BUCKET_INCR | BUCKET_ID | **TRIP_TS_LOCAL** |

## Data Type Mapping

| Snowflake | SQL Server |
|-----------|------------|
| NUMBER(38,0) | BIGINT |
| NUMBER(10,0) | INT |
| NUMBER(1,0) | TINYINT |
| NUMBER(38,5) | DECIMAL(38,5) |
| NUMBER(38,6) | DECIMAL(38,6) |
| FLOAT | FLOAT |
| VARCHAR(n) | NVARCHAR(n) |
| VARCHAR(5000+) | NVARCHAR(MAX) |
| BOOLEAN | BIT |
| TIMESTAMP_NTZ | DATETIME2 |
| TIMESTAMP_NTZ(3) | DATETIME2(3) |

## Indexes

Each table includes an index on the archival column for efficient DELETE operations:
- Most tables: `IX_<table_name>_DW_MODIFY_TS`
- LH_EQUIPMENT_STATUS_EVENT_INCR: `IX_..._START_TS_LOCAL`
- LH_LOADING_CYCLE_INCR: `IX_..._CYCLE_START_TS_LOCAL`
- LH_BUCKET_INCR: `IX_..._TRIP_TS_LOCAL`

## Deployment

Run the deployment script from the parent directory:

```powershell
python deploy_sql_server_incr_objects.py
```

Or deploy individual tables using SSMS/Azure Data Studio:
1. Connect to `azwd22midbx02.eb8a77f2eea6.database.windows.net`
2. Select database `SNOWFLAKE_WG`
3. Execute each `.sql` file

## Author

Carlos Carrillo | 2026-01-28
