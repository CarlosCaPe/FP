CREATE VIEW [bag].[CONOPS_BAG_CRUSHER_DELTA_C_V] AS



--SELECT * FROM [BAG].[CONOPS_BAG_CRUSHER_DELTA_C_V]
CREATE VIEW [BAG].[CONOPS_BAG_CRUSHER_DELTA_C_V]
AS

SELECT
	dc.SITE_CODE,
	s.SHIFTFLAG,
	dc.SHIFTINDEX,
	CASE dc.DUMPNAME
		WHEN 'CRUSHER 2' THEN 'CRUSHER 2'
	END AS CRUSHER,
	AVG(dc.DELTA_C) AS DELTA_C
FROM BAG.CONOPS_BAG_SHIFT_INFO_V s
LEFT JOIN dbo.delta_c dc WITH(NOLOCK)
	ON s.shiftindex = dc.shiftindex
WHERE SITE_CODE = 'BAG'
	AND UNIT = 'Crusher'
GROUP BY dc.SITE_CODE, dc.SHIFTINDEX, s.SHIFTFLAG, dc.DUMPNAME

