CREATE VIEW [mor].[CONOPS_MOR_CRUSHER_DELTA_C_V] AS


--SELECT * FROM [mor].[CONOPS_MOR_CRUSHER_DELTA_C_V]
CREATE VIEW [mor].[CONOPS_MOR_CRUSHER_DELTA_C_V]
AS

SELECT
	dc.SITE_CODE,
	s.SHIFTFLAG,
	dc.SHIFTINDEX,
	CASE dc.DUMPNAME
		WHEN 'C2MFL' THEN 'CRUSHER 2'
		WHEN 'C3MIL' THEN 'CRUSHER 3'
	END AS CRUSHER,
	AVG(dc.DELTA_C) AS DELTA_C
FROM MOR.CONOPS_MOR_SHIFT_INFO_V s
LEFT JOIN dbo.delta_c dc WITH(NOLOCK)
	ON s.shiftindex = dc.shiftindex
WHERE SITE_CODE = 'MOR'
	AND UNIT = 'Crusher'
GROUP BY dc.SITE_CODE, dc.SHIFTINDEX, s.SHIFTFLAG, dc.DUMPNAME